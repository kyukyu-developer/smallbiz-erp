INVENTORY DATABASE NOTES
=============================

====================
WAREHOUSE
====================
CREATE TABLE warehouse (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(50),                -- Warehouse Name
    city VARCHAR(50),                -- City of Warehouse
    branch_type VARCHAR(20),         -- 'Main', 'Branch', 'Sub'
    is_main_warehouse BOOLEAN,       -- TRUE if this is a main warehouse
    parent_warehouse_id  VARCHAR(50) NULL,    -- NULL if main warehouse
    is_used_warehouse BOOLEAN DEFAULT TRUE,     -- Active flag
    active BOOLEAN DEFAULT TRUE,     -- Active flag

    -- Audit Fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),         -- e.g., 'CREATE', 'UPDATE', 'DELETE'

    FOREIGN KEY (parent_warehouse_id) REFERENCES warehouse(id)
);
Your Notes:
- Warehouses are hierarchical (Main → Branch → Sub).
- Only warehouses with is_main_warehouse = TRUE can receive stock.

Suggestions:
- Enforce main-warehouse-only stock receiving at service layer or DB trigger.
- Consider UNIQUE(name, city) to avoid duplicate warehouse records.
- If multi-company is planned, add company_id.

====================
UOM (Unit of Measure)
====================
CREATE TABLE uom (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,           -- Unit Name (Piece, Kg, Box)
    symbol VARCHAR(20) NOT NULL,         -- Unit symbol (pc, kg, bx)
    active BOOLEAN DEFAULT TRUE,          -- Active flag

    -- Audit Fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50)               -- e.g., 'CREATE', 'UPDATE', 'DELETE'
);

Your Notes:
- Defines measurement units such as Piece, Box, Kg.

Suggestions:
- Add UNIQUE(name) and UNIQUE(symbol).
- Keep UOM master global (do not delete, only deactivate).

====================
PRODUCT GROUP
====================
CREATE TABLE product_group (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,          -- Group Name (e.g., Food, Beverages)
    description VARCHAR(255),
    active BOOLEAN DEFAULT TRUE,

    -- Audit fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50)
);

Your Notes:
- High-level product classification (Food, Beverage).

Suggestions:
- Useful for financial and sales reporting.
- Avoid deep hierarchy here; keep it simple.

====================
PRODUCT CATEGORY
====================
CREATE TABLE product_category (
    id VARCHAR(50) PRIMARY KEY,
    group_id INT,                        -- Optional: link to product group
    name VARCHAR(50) NOT NULL,           
    description VARCHAR(255),
    active BOOLEAN DEFAULT TRUE,

    -- Audit fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (group_id) REFERENCES product_group(id)
);

Your Notes:
- More detailed classification under Product Group.

Suggestions:
- Enforce UNIQUE(group_id, name).
- Categories should remain stable to protect historical reports.

====================
PRODUCT BRAND
====================
CREATE TABLE product_brand (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,          -- Brand Name (e.g., Nestle, Coca-Cola)
    description VARCHAR(255),           -- Optional description
    active BOOLEAN DEFAULT TRUE,        -- Active flag

    -- Audit Fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50)             -- 'CREATE', 'UPDATE', 'DELETE'
);
Your Notes:
- Represents manufacturer or brand.

Suggestions:
- Add UNIQUE(name).
- Useful for marketing and sales analysis.

====================
ATTRIBUTE
====================
CREATE TABLE attribute (
    id VARCHAR(50) PRIMARY KEY,    
    name VARCHAR(50) NOT NULL,       -- e.g., Color, Size, Flavor
    active BOOLEAN DEFAULT TRUE,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50)
);
Your Notes:
- Defines variant dimensions like Color, Size.

Suggestions:
- Attributes should be global and reusable.
- Avoid deleting attributes once used.

====================
ATTRIBUTE VALUE
====================
CREATE TABLE attribute_value (
    id VARCHAR(50) PRIMARY KEY, 
    attribute_id INT NOT NULL,
    value VARCHAR(50) NOT NULL,      -- e.g., Red, Blue, M, L
    active BOOLEAN DEFAULT TRUE,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),
    FOREIGN KEY (attribute_id) REFERENCES attribute(id)
);

Your Notes:
- Defines allowed values for attributes (Red, Blue, M, L).

Suggestions:
- Enforce UNIQUE(attribute_id, value).
- Prevent deletion if used by any variant.

====================
PRODUCT
====================
CREATE TABLE product (
    id VARCHAR(50) PRIMARY KEY,
    code VARCHAR(20) NOT NULL,
    name VARCHAR(50) NOT NULL,

    group_id VARCHAR(50),
    category_id VARCHAR(50),
    brand_id VARCHAR(50),

    base_uom_id VARCHAR(50) NOT NULL,

    track_inventory BOOLEAN DEFAULT TRUE,
    has_variant BOOLEAN DEFAULT FALSE,
    has_batch BOOLEAN DEFAULT FALSE,
    has_serial BOOLEAN DEFAULT FALSE,

    reorder_level DECIMAL(10,2),
    allow_negative_stock BOOLEAN DEFAULT FALSE,
    active BOOLEAN DEFAULT TRUE,

    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (group_id) REFERENCES product_group(id),
    FOREIGN KEY (category_id) REFERENCES product_category(id),
    FOREIGN KEY (brand_id) REFERENCES product_brand(id),
    FOREIGN KEY (base_uom_id) REFERENCES uom(id)
);

Your Notes:
- track_inventory = FALSE means no stock ledger.
- Supports non-stock items like services or digital goods.

Suggestions:
- Enforce UNIQUE(code).
- Prevent stock transactions when track_inventory = FALSE.
- has_batch / has_serial should control UI and validation rules.

====================
PRODUCT UOM
====================
CREATE TABLE product_uom (
    id VARCHAR(50) PRIMARY KEY,
    product_id INT NOT NULL,           -- Link to product
    uom_id INT NOT NULL,               -- UOM like Piece, Pack, Box
    factor_to_base DECIMAL(18,4) NOT NULL, -- Conversion factor to base unit
    is_base BOOLEAN DEFAULT FALSE,     -- TRUE if this UOM is base unit
    active BOOLEAN DEFAULT TRUE,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (uom_id) REFERENCES uom(id)
);
Your Notes:
- Defines alternate selling or purchasing units.

Suggestions:
- Enforce UNIQUE(product_id, uom_id).
- Only one base UOM per product.

====================
PRODUCT UOM CONVERSION
====================
CREATE TABLE product_uom_conversion (
    id VARCHAR(50) PRIMARY KEY,
    product_id INT NOT NULL,
    from_uom_id INT NOT NULL,          -- Original unit
    to_uom_id INT NOT NULL,            -- Target unit
    factor DECIMAL(18,4) NOT NULL,     -- Multiply quantity in from_uom to get to_uom
    active BOOLEAN DEFAULT TRUE,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (from_uom_id) REFERENCES uom(id),
    FOREIGN KEY (to_uom_id) REFERENCES uom(id)
);
Your Notes:
- Handles explicit UOM-to-UOM conversions.

Suggestions:
- Optional if factor_to_base is sufficient.
- Keep conversion logic centralized in service layer.

====================
PRODUCT VARIANT
====================
CREATE TABLE product_variant (
    id VARCHAR(50) PRIMARY KEY,
    product_id INT NOT NULL,
    sku VARCHAR(50) NOT NULL,   -- TS001-R-M,TS001-B-M
    base_uom_id INT NOT NULL,
    track_inventory BOOLEAN DEFAULT TRUE,
    active BOOLEAN DEFAULT TRUE,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (base_uom_id) REFERENCES uom(id)
);

Your Notes:
- Represents SKU-level inventory items.

Suggestions:
- Enforce UNIQUE(sku).
- Variant should inherit stock rules from product by default.

====================
PRODUCT VARIANT ATTRIBUTE
====================
CREATE TABLE product_variant_attribute (
    id VARCHAR(50) PRIMARY KEY,
    variant_id INT NOT NULL,
    attribute_id INT NOT NULL, -- 1 (Color) , 2(Size)
    value_id INT NOT NULL,  -- Red , Medium
    active BOOLEAN DEFAULT TRUE,        -- Active flag

    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),
    FOREIGN KEY (variant_id) REFERENCES product_variant(id),
    FOREIGN KEY (attribute_id) REFERENCES attribute(id),
    FOREIGN KEY (value_id) REFERENCES attribute_value(id)
);
Your Notes:
- Links variant to attribute values.

Suggestions:
- Enforce UNIQUE(variant_id, attribute_id).
- Validate value belongs to attribute.

====================
STOCK RECEIVE
====================
CREATE TABLE stock_receive (
    id VARCHAR(50) PRIMARY KEY,
    receive_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    reference_no VARCHAR(50),              -- GRN-0001
    warehouse_id VARCHAR(50) NOT NULL,
    supplier_id VARCHAR(50) NULL,
    
    reference_stock_type VARCHAR(50) NULL, -- 'PURCHASE_ORDER', 'STOCK_RETURN', 'TRANSFER_IN'
    reference_stock_id VARCHAR(50) NULL,   -- ID of source document
    
    remarks VARCHAR(255),

    status VARCHAR(20) DEFAULT 'DRAFT',    -- DRAFT, POSTED, CANCELLED
    total_amount DECIMAL(18,4) DEFAULT 0,  -- sum of line totals
    total_tax DECIMAL(18,4) DEFAULT 0,
    grand_total DECIMAL(18,4) DEFAULT 0,

    active BOOLEAN DEFAULT TRUE,           -- Active flag

    -- Audit Fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (warehouse_id) REFERENCES warehouse(id),
    FOREIGN KEY (supplier_id) REFERENCES supplier(id)
);


Your Notes:
- Stock can only be received into main warehouse.
- Used for purchase and GRN.
- reference_stock_type + reference_stock_id allow GRN to link to any source: 
  Purchase Order, Stock Return, Transfer-In, Production Output.
- status controls whether stock is posted to ledger.

Suggestions:
- Validate warehouse.is_main_warehouse = TRUE.
- Generate reference_no automatically.
- Validate reference_stock_id exists in the proper table based on type at service layer or trigger.
- Generate reference_no automatically (GRN-YYYYMMDD-XXXX).

====================
STOCK RECEIVE LINE
====================
CREATE TABLE stock_receive_line (
    id VARCHAR(50) PRIMARY KEY,
    receive_id VARCHAR(50) NOT NULL,

    product_id VARCHAR(50) NOT NULL,
    variant_id VARCHAR(50) NULL,

    uom_id VARCHAR(50) NOT NULL,                  -- Transaction UOM (Box, Pack)
    quantity DECIMAL(18,4) NOT NULL,             -- Qty entered by user

    unit_price DECIMAL(18,4) NOT NULL,           -- Price per transaction UOM
    line_total DECIMAL(18,4) NOT NULL,           -- quantity * unit_price

    base_uom_id VARCHAR(50) NOT NULL,            -- Product base UOM
    base_quantity DECIMAL(18,4) NOT NULL,        -- Converted quantity
    base_unit_price DECIMAL(18,4) NOT NULL,      -- Price per base UOM
    base_line_total DECIMAL(18,4) NOT NULL,      -- base_quantity * base_unit_price

    tax DECIMAL(18,4) DEFAULT 0,                 -- Tax per line
    discount DECIMAL(18,4) DEFAULT 0,            -- Discount per line

    status VARCHAR(20) DEFAULT 'OPEN',           -- OPEN, POSTED, CLOSED
    active BOOLEAN DEFAULT TRUE,                 -- Active flag

    -- Audit Fields
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (receive_id) REFERENCES stock_receive(id),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (variant_id) REFERENCES product_variant(id),
    FOREIGN KEY (uom_id) REFERENCES uom(id),
    FOREIGN KEY (base_uom_id) REFERENCES uom(id)
);


Your Notes:
- Base quantity is always calculated.
- Transaction UOM is user-facing.
- base_quantity always calculated from quantity * conversion_factor.
- status tracks posting to stock ledger.
- Can store tax/discount per line for GRN totals.

Suggestions:
- SUM(detail.quantity) must equal base_quantity.
- Prevent variant_id NULL when product.has_variant = TRUE.
- Enforce unique (receive_id, product_id, variant_id) to avoid duplicates.
- Prevent over-receiving if linked to a PO or return.
- Support batch/serial numbers as optional columns if product requires it.

====================
STOCK DELIVERY
====================
CREATE TABLE stock_delivery (
    id VARCHAR(50) PRIMARY KEY,
    delivery_no VARCHAR(50),
    delivery_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    delivery_type VARCHAR(20) NOT NULL, -- SALE, ISSUE, WRITE_OFF, CONSUMPTION

    warehouse_id INT NOT NULL,       -- source warehouse
    customer_id INT NULL,            -- only for SALE
    department_id INT NULL,          -- for ISSUE / CONSUMPTION

    remarks VARCHAR(255),

    active BOOLEAN DEFAULT TRUE,        -- Active flag
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (warehouse_id) REFERENCES warehouse(id)
);


Your Notes:
- Handles SALE, ISSUE, WRITE_OFF, CONSUMPTION.

Suggestions:
- Validate stock availability before posting.
- Link SALE to sales invoice if available.

====================
STOCK DELIVERY LINE
====================
CREATE TABLE stock_delivery_line (
    id VARCHAR(50) PRIMARY KEY,
    delivery_id INT NOT NULL,

    product_id INT NOT NULL,
    variant_id INT NULL,

    uom_id INT NOT NULL,                  -- transaction UOM
    quantity DECIMAL(18,4) NOT NULL,

    base_uom_id INT NOT NULL,
    base_quantity DECIMAL(18,4) NOT NULL,

    unit_cost DECIMAL(18,4) NOT NULL,     -- cost at delivery time
    line_total_cost DECIMAL(18,4) NOT NULL,

    active BOOLEAN DEFAULT TRUE,        -- Active flag
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (delivery_id) REFERENCES stock_delivery(id),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (variant_id) REFERENCES product_variant(id),
    FOREIGN KEY (uom_id) REFERENCES uom(id),
    FOREIGN KEY (base_uom_id) REFERENCES uom(id)
);


Your Notes:
- Base quantity deducted from stock.

Suggestions:
- Cost should be calculated using FIFO or AVG.
- Prevent negative stock if product.allow_negative_stock = FALSE.

====================
STOCK Moments DETAIL
====================
CCREATE TABLE stock_movement_detail (
    id VARCHAR(50) PRIMARY KEY,

    warehouse_id INT NOT NULL,

    product_id INT NOT NULL,
    variant_id INT NULL,

    reference_type VARCHAR(50) NOT NULL,  
    -- 'RECEIVE', 'DELIVERY', 'TRANSFER_IN', 'TRANSFER_OUT', 'ADJUSTMENT'

    reference_id INT NOT NULL,          
    -- stock_receive.id / stock_delivery.id / etc.

    reference_line_id INT NOT NULL,     
    -- stock_receive_line.id / stock_delivery_line.id / etc.

    movement_type VARCHAR(10) NOT NULL, 
    -- 'IN' or 'OUT'

    batch_no VARCHAR(50) NULL,
    serial_no VARCHAR(50) NULL,

    quantity DECIMAL(18,4) NOT NULL,    
    -- ALWAYS base unit quantity

    active BOOLEAN DEFAULT TRUE,        
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (warehouse_id) REFERENCES warehouse(id),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (variant_id) REFERENCES product_variant(id)
);


Your Notes:
- Used for batch and serial tracking.
- Serial products must have quantity = 1.
- Tracks batch and serial during delivery.

Suggestions:
- Ensure delivered serials exist and are not reused.
- Quantity should always be base unit.
- Enforce unique serial_no (global or per product).
- Batch number optional but recommended for expiry tracking.

====================
STOCK LEDGER
====================
CREATE TABLE stock_ledger (
    id INT PRIMARY KEY,

    warehouse_id INT NOT NULL,
    product_id INT NOT NULL,
    variant_id INT NULL,

    base_uom_id INT NOT NULL,
    quantity DECIMAL(18,4) NOT NULL,            -- base quantity
    value DECIMAL(18,4) NOT NULL,               -- base value

    stock_type VARCHAR(10) NOT NULL,            -- IN / OUT
    reference_type VARCHAR(50),                 -- Stock Receive
    reference_id INT,                           -- stock_receive.id

    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    modified_by VARCHAR(50),
    last_action VARCHAR(50),

    FOREIGN KEY (warehouse_id) REFERENCES warehouse(id),
    FOREIGN KEY (product_id) REFERENCES product(id),
    FOREIGN KEY (variant_id) REFERENCES product_variant(id),
    FOREIGN KEY (base_uom_id) REFERENCES uom(id)
);
Your Notes:
- Stores IN / OUT stock movements.
- Reference points to source transaction.

Suggestions:
- Never update or delete ledger rows.
- Ledger should be written only by Stock Service.
- Use this table as the source of truth for stock balance.
